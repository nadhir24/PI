(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=281)})({1:function(module,exports){module.exports=l},281:function(module,exports,__webpack_require__){module.exports=__webpack_require__(282)},282:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var qrscan=__webpack_require__(283);var keys=Object.keys(qrscan)},283:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var qr_scanner_1=__webpack_require__(284);var l=__webpack_require__(1);qr_scanner_1.default.WORKER_PATH="/msa/mse/plugins/qr-scanner-worker.min.js";var messageBox_html='\n<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="qrScanMessage" id="qrScanMessageBox" style="display: none;">\n    <div class="modal-dialog modal-sm" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>\n          <h4 class="modal-title" id="qrScanMessage">'+l.Translator.translate("tips")+'</h4>\n        </div>\n        <div class="modal-body">\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">'+l.Translator.translate("close")+"</button>\n        </div>\n      </div>\n    </div>\n  </div>\n";function MessageBox(){var boxid="qrScanMessageBox";var contentid="qr_message";$("body").append(messageBox_html);var box_el=$("#"+boxid),body_el=$("#"+boxid+" .modal-body");function show(txt){body_el.text(txt);box_el.modal("show")}function close(){body_el.text("");box_el.modal("hide")}return{show:show,close:close}}var msgBox=MessageBox();function QrScan(){var instance;var video_el,scan_box;function initElement(){scan_box=$("<div id='scan_box' class='qrscan-box'></div>");if(!video_el){video_el=$("<video id='qrscan'/>");scan_box.append(video_el)}$("body").append(scan_box);var close_btn=$("<div class='btn btn-danger scan_close'>"+l.Translator.translate("close")+"</div>");scan_box.append(close_btn);close_btn.click((function(){return stop()}))}initElement();function getInstance(){if(instance)return instance;instance=new qr_scanner_1.default(video_el.get(0),resultFunc);return instance}function start(){return __awaiter(this,void 0,void 0,(function(){var ins,error_1;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,hasCamera()];case 1:if(!_a.sent())return[2];ins=getInstance();_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,ins.start()];case 3:_a.sent();scan_box.show();return[3,5];case 4:error_1=_a.sent();scan_box.hide();alert(l.Translator.translate("give access permission|please give Camera access permission by refreshing the page"));return[3,5];case 5:return[2]}}))}))}function stop(){scan_box.hide();var ins=getInstance();ins.stop()}window.onbeforeunload=function(event){var ins=getInstance();ins.destroy();console.log("destroy qrscan")};function hasCamera(){return __awaiter(this,void 0,void 0,(function(){var flag;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,qr_scanner_1.default.hasCamera()];case 1:flag=_a.sent();console.log("has Camera:"+flag);return[2,flag]}}))}))}function resultFunc(result){console.log("decoded qr code:",result);var domainReg=/^(http(s)?(:\/\/))?[a-z.]+\.lenovo\.com/i;if(domainReg.test(result)){var url=result.startsWith("http")?result:"https://"+result;var urlObj=new URL(url);urlObj.search+=(urlObj.search?"&":"?")+"cid=all:other:51hmvi";location.href=urlObj.href}else{msgBox.show(result)}scan_box.hide();var ins=getInstance();ins.stop()}function isMobile(){return l.MobileDetectControl.mobileResource.mobile()||l.MobileDetectControl.mobileResource.tablet()}var country=l.CultureUtility.getCurrentCountry().toLowerCase();function init(){return __awaiter(this,void 0,void 0,(function(){var flag,rs,countries,error_2;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,hasCamera()];case 1:flag=_a.sent();if(!(isMobile()&&flag))return[3,5];_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,$.get("/api/configurations/mse-guide/en/item?path=/sitecore/content/Sites/PCG/Home/Configurations/QRScanConfig")];case 3:rs=_a.sent();countries=rs.Countries||[];if(countries.some((function(x){return x.toLowerCase()===country}))){return[2,true]}return[3,5];case 4:error_2=_a.sent();console.error(error_2);return[3,5];case 5:return[2,false]}}))}))}return{start:start,stop:stop,init:init}}window.QrScan=QrScan();var _a=QrScan(),start=_a.start,stop=_a.stop,init=_a.init;exports.start=start;exports.stop=stop;exports.init=init},284:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return QrScanner}));class QrScanner{static hasCamera(){if(!navigator.mediaDevices)return Promise.resolve(false);return navigator.mediaDevices.enumerateDevices().then(devices=>devices.some(device=>device.kind==="videoinput")).catch(()=>false)}constructor(video,onDecode,canvasSizeOrOnDecodeError=this._onDecodeError.bind(this),canvasSize=QrScanner.DEFAULT_CANVAS_SIZE,preferredFacingMode="environment"){this.$video=video;this.$canvas=document.createElement("canvas");this._onDecode=onDecode;this._preferredFacingMode=preferredFacingMode;this._active=false;this._paused=false;this._flashOn=false;if(typeof canvasSizeOrOnDecodeError==="number"){canvasSize=canvasSizeOrOnDecodeError;console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in "+"the future")}else{this._onDecodeError=canvasSizeOrOnDecodeError}this.$canvas.width=canvasSize;this.$canvas.height=canvasSize;this._sourceRect={x:0,y:0,width:canvasSize,height:canvasSize};this._updateSourceRect=this._updateSourceRect.bind(this);this._onPlay=this._onPlay.bind(this);this._onVisibilityChange=this._onVisibilityChange.bind(this);this.$video.playsInline=true;this.$video.muted=true;this.$video.disablePictureInPicture=true;this.$video.addEventListener("loadedmetadata",this._updateSourceRect);this.$video.addEventListener("play",this._onPlay);document.addEventListener("visibilitychange",this._onVisibilityChange);this._qrEnginePromise=QrScanner.createQrEngine()}hasFlash(){if(!("ImageCapture"in window)){return Promise.resolve(false)}const track=this.$video.srcObject?this.$video.srcObject.getVideoTracks()[0]:null;if(!track){return Promise.reject("Camera not started or not available")}const imageCapture=new ImageCapture(track);return imageCapture.getPhotoCapabilities().then(result=>result.fillLightMode.includes("flash")).catch(error=>{console.warn(error);return false})}isFlashOn(){return this._flashOn}toggleFlash(){return this._setFlash(!this._flashOn)}turnFlashOff(){return this._setFlash(false)}turnFlashOn(){return this._setFlash(true)}destroy(){this.$video.removeEventListener("loadedmetadata",this._updateSourceRect);this.$video.removeEventListener("play",this._onPlay);document.removeEventListener("visibilitychange",this._onVisibilityChange);this.stop();QrScanner._postWorkerMessage(this._qrEnginePromise,"close")}start(){if(this._active&&!this._paused){return Promise.resolve()}if(window.location.protocol!=="https:"){console.warn("The camera stream is only accessible if the page is transferred via https.")}this._active=true;this._paused=false;if(document.hidden){return Promise.resolve()}clearTimeout(this._offTimeout);this._offTimeout=null;if(this.$video.srcObject){this.$video.play();return Promise.resolve()}let facingMode=this._preferredFacingMode;return this._getCameraStream(facingMode,true).catch(()=>{facingMode=facingMode==="environment"?"user":"environment";return this._getCameraStream()}).then(stream=>{facingMode=this._getFacingMode(stream)||facingMode;this.$video.srcObject=stream;this.$video.play();this._setVideoMirror(facingMode)}).catch(e=>{this._active=false;throw e})}stop(){this.pause();this._active=false}pause(){this._paused=true;if(!this._active){return}this.$video.pause();if(this._offTimeout){return}this._offTimeout=setTimeout(()=>{const tracks=this.$video.srcObject?this.$video.srcObject.getTracks():[];for(const track of tracks){track.stop()}this.$video.srcObject=null;this._offTimeout=null},300)}static scanImage(imageOrFileOrUrl,sourceRect=null,qrEngine=null,canvas=null,fixedCanvasSize=false,alsoTryWithoutSourceRect=false){const gotExternalWorker=qrEngine instanceof Worker;let promise=Promise.all([qrEngine||QrScanner.createQrEngine(),QrScanner._loadImage(imageOrFileOrUrl)]).then(([engine,image])=>{qrEngine=engine;let canvasContext;[canvas,canvasContext]=this._drawToCanvas(image,sourceRect,canvas,fixedCanvasSize);if(qrEngine instanceof Worker){if(!gotExternalWorker){qrEngine.postMessage({type:"inversionMode",data:"both"})}return new Promise((resolve,reject)=>{let timeout,onMessage,onError;onMessage=event=>{if(event.data.type!=="qrResult"){return}qrEngine.removeEventListener("message",onMessage);qrEngine.removeEventListener("error",onError);clearTimeout(timeout);if(event.data.data!==null){resolve(event.data.data)}else{reject(QrScanner.NO_QR_CODE_FOUND)}};onError=e=>{qrEngine.removeEventListener("message",onMessage);qrEngine.removeEventListener("error",onError);clearTimeout(timeout);const errorMessage=!e?"Unknown Error":e.message||e;reject("Scanner error: "+errorMessage)};qrEngine.addEventListener("message",onMessage);qrEngine.addEventListener("error",onError);timeout=setTimeout(()=>onError("timeout"),1e4);const imageData=canvasContext.getImageData(0,0,canvas.width,canvas.height);qrEngine.postMessage({type:"decode",data:imageData},[imageData.data.buffer])})}else{return new Promise((resolve,reject)=>{const timeout=setTimeout(()=>reject("Scanner error: timeout"),1e4);qrEngine.detect(canvas).then(scanResults=>{if(!scanResults.length){reject(QrScanner.NO_QR_CODE_FOUND)}else{resolve(scanResults[0].rawValue)}}).catch(e=>reject("Scanner error: "+(e.message||e))).finally(()=>clearTimeout(timeout))})}});if(sourceRect&&alsoTryWithoutSourceRect){promise=promise.catch(()=>QrScanner.scanImage(imageOrFileOrUrl,null,qrEngine,canvas,fixedCanvasSize))}promise=promise.finally(()=>{if(gotExternalWorker)return;QrScanner._postWorkerMessage(qrEngine,"close")});return promise}setGrayscaleWeights(red,green,blue,useIntegerApproximation=true){QrScanner._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:red,green:green,blue:blue,useIntegerApproximation:useIntegerApproximation})}setInversionMode(inversionMode){QrScanner._postWorkerMessage(this._qrEnginePromise,"inversionMode",inversionMode)}static createQrEngine(workerPath=QrScanner.WORKER_PATH){return("BarcodeDetector"in window?BarcodeDetector.getSupportedFormats():Promise.resolve([])).then(supportedFormats=>supportedFormats.indexOf("qr_code")!==-1?new BarcodeDetector({formats:["qr_code"]}):new Worker(workerPath))}_onPlay(){this._updateSourceRect();this._scanFrame()}_onVisibilityChange(){if(document.hidden){this.pause()}else if(this._active){this.start()}}_updateSourceRect(){const smallestDimension=Math.min(this.$video.videoWidth,this.$video.videoHeight);const sourceRectSize=Math.round(2/3*smallestDimension);this._sourceRect.width=this._sourceRect.height=sourceRectSize;this._sourceRect.x=(this.$video.videoWidth-sourceRectSize)/2;this._sourceRect.y=(this.$video.videoHeight-sourceRectSize)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return false;requestAnimationFrame(()=>{if(this.$video.readyState<=1){this._scanFrame();return}this._qrEnginePromise.then(qrEngine=>QrScanner.scanImage(this.$video,this._sourceRect,qrEngine,this.$canvas,true)).then(this._onDecode,error=>{if(!this._active)return;const errorMessage=error.message||error;if(errorMessage.indexOf("service unavailable")!==-1){this._qrEnginePromise=QrScanner.createQrEngine()}this._onDecodeError(error)}).then(()=>this._scanFrame())})}_onDecodeError(error){if(error===QrScanner.NO_QR_CODE_FOUND)return;console.log(error)}_getCameraStream(facingMode,exact=false){const constraintsToTry=[{width:{min:1024}},{width:{min:768}},{}];if(facingMode){if(exact){facingMode={exact:facingMode}}constraintsToTry.forEach(constraint=>constraint.facingMode=facingMode)}return this._getMatchingCameraStream(constraintsToTry)}_getMatchingCameraStream(constraintsToTry){if(!navigator.mediaDevices||constraintsToTry.length===0){return Promise.reject("Camera not found.")}return navigator.mediaDevices.getUserMedia({video:constraintsToTry.shift()}).catch(()=>this._getMatchingCameraStream(constraintsToTry))}_setFlash(on){return this.hasFlash().then(hasFlash=>{if(!hasFlash)return Promise.reject("No flash available");return this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:on}]})}).then(()=>this._flashOn=on)}_setVideoMirror(facingMode){const scaleFactor=facingMode==="user"?-1:1;this.$video.style.transform="scaleX("+scaleFactor+")"}_getFacingMode(videoStream){const videoTrack=videoStream.getVideoTracks()[0];if(!videoTrack)return null;return/rear|back|environment/i.test(videoTrack.label)?"environment":/front|user|face/i.test(videoTrack.label)?"user":null}static _drawToCanvas(image,sourceRect=null,canvas=null,fixedCanvasSize=false){canvas=canvas||document.createElement("canvas");const sourceRectX=sourceRect&&sourceRect.x?sourceRect.x:0;const sourceRectY=sourceRect&&sourceRect.y?sourceRect.y:0;const sourceRectWidth=sourceRect&&sourceRect.width?sourceRect.width:image.width||image.videoWidth;const sourceRectHeight=sourceRect&&sourceRect.height?sourceRect.height:image.height||image.videoHeight;if(!fixedCanvasSize&&(canvas.width!==sourceRectWidth||canvas.height!==sourceRectHeight)){canvas.width=sourceRectWidth;canvas.height=sourceRectHeight}const context=canvas.getContext("2d",{alpha:false});context.imageSmoothingEnabled=false;context.drawImage(image,sourceRectX,sourceRectY,sourceRectWidth,sourceRectHeight,0,0,canvas.width,canvas.height);return[canvas,context]}static _loadImage(imageOrFileOrBlobOrUrl){if(imageOrFileOrBlobOrUrl instanceof HTMLCanvasElement||imageOrFileOrBlobOrUrl instanceof HTMLVideoElement||window.ImageBitmap&&imageOrFileOrBlobOrUrl instanceof window.ImageBitmap||window.OffscreenCanvas&&imageOrFileOrBlobOrUrl instanceof window.OffscreenCanvas){return Promise.resolve(imageOrFileOrBlobOrUrl)}else if(imageOrFileOrBlobOrUrl instanceof Image){return QrScanner._awaitImageLoad(imageOrFileOrBlobOrUrl).then(()=>imageOrFileOrBlobOrUrl)}else if(imageOrFileOrBlobOrUrl instanceof File||imageOrFileOrBlobOrUrl instanceof Blob||imageOrFileOrBlobOrUrl instanceof URL||typeof imageOrFileOrBlobOrUrl==="string"){const image=new Image;if(imageOrFileOrBlobOrUrl instanceof File||imageOrFileOrBlobOrUrl instanceof Blob){image.src=URL.createObjectURL(imageOrFileOrBlobOrUrl)}else{image.src=imageOrFileOrBlobOrUrl}return QrScanner._awaitImageLoad(image).then(()=>{if(imageOrFileOrBlobOrUrl instanceof File||imageOrFileOrBlobOrUrl instanceof Blob){URL.revokeObjectURL(image.src)}return image})}else{return Promise.reject("Unsupported image type.")}}static _awaitImageLoad(image){return new Promise((resolve,reject)=>{if(image.complete&&image.naturalWidth!==0){resolve()}else{let onLoad,onError;onLoad=()=>{image.removeEventListener("load",onLoad);image.removeEventListener("error",onError);resolve()};onError=()=>{image.removeEventListener("load",onLoad);image.removeEventListener("error",onError);reject("Image load error")};image.addEventListener("load",onLoad);image.addEventListener("error",onError)}})}static _postWorkerMessage(qrEngineOrQrEnginePromise,type,data){return Promise.resolve(qrEngineOrQrEnginePromise).then(qrEngine=>{if(!(qrEngine instanceof Worker))return;qrEngine.postMessage({type:type,data:data})})}}QrScanner.DEFAULT_CANVAS_SIZE=400;QrScanner.NO_QR_CODE_FOUND="No QR code found";QrScanner.WORKER_PATH="qr-scanner-worker.min.js"}});
//# sourceMappingURL=pcg_qrscan.bundle.js.map